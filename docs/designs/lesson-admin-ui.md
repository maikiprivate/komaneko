# レッスン管理画面 UI設計書

## 概要

コース→セクション→レッスン→問題の階層構造を管理する画面のUI設計。

## 設計方針

| 項目 | 選択 |
|------|------|
| UI構造 | コース→セクション→レッスンはネスト/アコーディオン型、問題は個別ページ |
| 一覧形式 | テーブル形式 |
| 並び替え | 上下ボタン |
| 将棋盤 | 管理画面用に新規作成、駒台付き、共通コンポーネント化、デザインはアプリと同様 |
| 管理画面トンマナ | 白ベース + プライマリカラー（オレンジ #FF8C42）をアクセント |

---

## 画面構成

### 1. レッスン管理一覧（/lesson）

**レイアウト**: ネスト可能なテーブル

```
┌─────────────────────────────────────────────────────────────┐
│ レッスン管理                              [+ コース追加]    │
├─────────────────────────────────────────────────────────────┤
│ ▼ 駒の動かし方 (draft)                    [編集] [削除] [↑↓]│
│   ├─ ▼ 歩の動き                           [編集] [削除] [↑↓]│
│   │   ├─ 歩を動かそう (3問)              [問題編集] [↑↓]   │
│   │   └─ 歩で取る (2問)                  [問題編集] [↑↓]   │
│   ├─ ▶ 金の動き                           [編集] [削除] [↑↓]│
│   └─ ▶ 銀の動き                           [編集] [削除] [↑↓]│
│ ▶ 基本の攻め方 (draft)                    [編集] [削除] [↑↓]│
│ ▶ 詰みの形 (locked)                       [編集] [削除] [↑↓]│
└─────────────────────────────────────────────────────────────┘
```

**機能**:
- コース/セクション/レッスンの展開・折りたたみ
- モーダルで編集（タイトル、ステータス）
- 上下ボタンで並び替え
- 問題数の表示
- [問題編集] ボタンで問題編集ページへ遷移

### 2. 問題編集ページ（/lesson/problems/:lessonId）

**レイアウト**: 将棋盤 + 問題リスト（2カラム）

```
┌─────────────────────────────────────────────────────────────┐
│ ← 戻る  歩を動かそう - 問題編集                             │
├──────────────────────────────┬──────────────────────────────┤
│                              │ 問題一覧          [+ 追加]  │
│     ┌─────────────┐          │ ─────────────────────────── │
│     │             │          │ 1. 歩を前に進めよう [↑↓][×]│
│     │  将棋盤     │          │ 2. 敵の駒を取ろう   [↑↓][×]│
│     │  (9x9)      │          │ 3. 成れる場所へ     [↑↓][×]│
│     │             │          │                             │
│     └─────────────┘          │                             │
│                              │                             │
│ 指示文: [________________]   │                             │
│ 正解手: [7g7f] [追加]        │                             │
│                              │                             │
│        [保存]                │                             │
└──────────────────────────────┴──────────────────────────────┘
```

**機能**:
- 将棋盤のGUI操作（駒配置、初期局面設定）
- SFEN形式の自動生成
- 指示文の入力
- 正解手の設定（クリックで駒を動かして設定）
- 問題リストの選択・並び替え・削除

---

## 将棋盤コンポーネント

**方針**: 管理画面用に共通コンポーネントとして新規作成

### コンポーネント構成

| コンポーネント | 役割 |
|---------------|------|
| `ShogiBoard.tsx` | 9x9の盤面表示、セル選択、ハイライト |
| `Piece.tsx` | 駒画像表示 |
| `PieceStand.tsx` | 駒台（持ち駒）表示 |
| `ShogiBoardWithStands.tsx` | 盤面 + 駒台のセット（共通レイアウト） |

### lib/shogi ロジック

| ファイル | 役割 |
|---------|------|
| `types.ts` | 型定義（PieceType, Board, Position等） |
| `sfen.ts` | SFEN解析・生成 |
| `perspective.ts` | 視点変換（先手/後手） |

### 将棋盤デザイン（アプリと同様）

アプリ側と同じ木目調デザイン:
- 盤面背景: `#E8C98E`（木目調）
- セル境界: `#A0826D`
- 駒台背景: `#D6B891`
- 選択セル: アプリと同様のハイライト

---

## 管理画面デザインガイドライン

**トンマナ**: 白ベース + オレンジ（#FF8C42）アクセント

| 要素 | スタイル |
|------|---------|
| 背景 | `bg-gray-100`（メイン）、`bg-white`（カード） |
| テキスト | `text-gray-900`（見出し）、`text-gray-600`（本文） |
| ボタン（プライマリ） | `bg-primary text-white hover:bg-primary-dark` |
| ボタン（セカンダリ） | `bg-white border border-gray-300 text-gray-700` |
| ボーダー | `border-gray-200`（薄い）、`border-gray-300`（通常） |
| 選択状態 | `bg-primary/10 border-primary`（薄オレンジ背景） |
| ホバー | `hover:bg-gray-50`（行）、`hover:bg-primary-dark`（ボタン） |

---

## ファイル構成

```
packages/admin/
├── public/
│   └── pieces/                 # 駒画像（14種類）
└── src/
    ├── mocks/
    │   └── lessonData.ts           # モックデータ
    ├── components/
    │   ├── shogi/
    │   │   ├── ShogiBoard.tsx          # 将棋盤（9x9）
    │   │   ├── Piece.tsx               # 駒表示
    │   │   ├── PieceStand.tsx          # 駒台
    │   │   └── ShogiBoardWithStands.tsx # 盤面 + 駒台セット
    │   ├── ui/
    │   │   └── Modal.tsx               # モーダル共通
    │   └── lesson/
    │       └── NestedLessonTable.tsx   # ネスト可能テーブル
    ├── pages/
    │   └── lesson/
    │       ├── LessonList.tsx      # 一覧（ネスト型）
    │       └── ProblemEdit.tsx     # 問題編集
    └── lib/
        └── shogi/
            ├── types.ts            # 型定義
            ├── sfen.ts             # SFEN処理
            └── perspective.ts      # 視点変換
```

---

## 実装ステップ

### Step 1: 将棋盤共通コンポーネント
1. 駒画像を `packages/admin/public/pieces/` に配置
2. `lib/shogi/types.ts` - 型定義
3. `lib/shogi/sfen.ts` - SFEN解析
4. `lib/shogi/perspective.ts` - 視点変換
5. `components/shogi/Piece.tsx` - 駒表示
6. `components/shogi/ShogiBoard.tsx` - 盤面
7. `components/shogi/PieceStand.tsx` - 駒台
8. `components/shogi/ShogiBoardWithStands.tsx` - セットレイアウト

### Step 2: モックデータ作成
- `packages/admin/src/mocks/lessonData.ts`
- 既存アプリのモックデータを参考に管理画面用に調整

### Step 3: レッスン管理一覧ページ
- `packages/admin/src/pages/lesson/LessonList.tsx`
- ネスト可能なテーブルコンポーネント
- 展開/折りたたみ機能
- 上下ボタン（並び替えはモック段階では状態管理のみ）

### Step 4: 編集モーダル
- コース追加/編集モーダル
- セクション追加/編集モーダル
- レッスン追加/編集モーダル
- 共通Modalコンポーネント

### Step 5: 問題編集ページ
- `packages/admin/src/pages/lesson/ProblemEdit.tsx`
- レイアウト（2カラム: 将棋盤 + 問題リスト）
- 問題リスト表示・選択

### Step 6: 問題編集機能
- SFEN表示・編集
- 指示文入力
- 正解手設定（UIで駒を動かして設定）

---

## 注意事項

- モック段階ではAPI呼び出しなし（状態はローカルで管理）
- 将棋盤は最低限の表示・操作機能のみ
- 複雑な検証ロジック（SFEN妥当性等）は後回し
