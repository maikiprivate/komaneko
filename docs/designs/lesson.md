# é§’å¡¾ï¼ˆLessonï¼‰è¨­è¨ˆ

## æ¦‚è¦

Duolingo Chess ã‚’å‚è€ƒã«ã—ãŸå°†æ£‹å­¦ç¿’ã‚·ã‚¹ãƒ†ãƒ ã€‚é§’ã®å‹•ã‹ã—æ–¹ã‹ã‚‰å®šè·¡ãƒ»æ‰‹ç­‹ã¾ã§å¹…åºƒãå­¦ã¹ã‚‹ã€‚

## è¨­è¨ˆæ–¹é‡

### ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æ§‹é€ 

```
Courseï¼ˆã‚³ãƒ¼ã‚¹ï¼‰
â”œâ”€â”€ Sectionï¼ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼‰
â”‚   â”œâ”€â”€ Lessonï¼ˆãƒ¬ãƒƒã‚¹ãƒ³ï¼‰
â”‚   â”‚   â”œâ”€â”€ Problem 1
â”‚   â”‚   â”œâ”€â”€ Problem 2
â”‚   â”‚   â””â”€â”€ ...ï¼ˆ5-10å•ï¼‰
â”‚   â””â”€â”€ ...
â””â”€â”€ ...
```

### æ­£è§£åˆ¤å®šã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

è©°å°†æ£‹ã¨ã¯ç•°ãªã‚Šã€**äº‹å‰å®šç¾©ã®æ‰‹é †ã¨æ¯”è¼ƒ**ã—ã¦æ­£è§£ã‚’åˆ¤æ–­ã™ã‚‹ã€‚

```
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé§’ã‚’å‹•ã‹ã™
2. äº‹å‰å®šç¾©ã®æ­£è§£æ‰‹é †ã¨æ¯”è¼ƒ
   - ä¸€è‡´ â†’ æ¬¡ã®æ‰‹ã¸ï¼ˆã¾ãŸã¯æ­£è§£ï¼‰
   - ä¸ä¸€è‡´ â†’ ä¸æ­£è§£
3. å¿…è¦æ‰‹æ•°ã‚’æº€ãŸã—ãŸã‚‰ â†’ æ­£è§£ï¼
```

è¤‡æ•°ã®æ­£è§£æ‰‹é †ãŒã‚ã‚‹å ´åˆã¯ã€`correctMoves: Move[][]` ã§è¤‡æ•°ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å®šç¾©ã€‚

## ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

### å‹å®šç¾©

```typescript
/** ã‚³ãƒ¼ã‚¹ */
interface Course {
  id: string
  title: string           // ã€Œé§’ã®å‹•ã‹ã—æ–¹ã€
  description: string
  sections: Section[]
  status: 'locked' | 'available' | 'in_progress' | 'completed'
}

/** ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
interface Section {
  id: string
  title: string           // ã€Œæ­©ã¨é‡‘ã€
  lessons: Lesson[]
  status: 'locked' | 'available' | 'in_progress' | 'completed'
}

/** ãƒ¬ãƒƒã‚¹ãƒ³ */
interface Lesson {
  id: string
  title: string           // ã€Œæ­©ã®åŸºæœ¬ã€
  problems: Problem[]
  status: 'locked' | 'available' | 'in_progress' | 'completed'
}

/** å•é¡Œï¼ˆç›¤é¢æ“ä½œå‹ï¼‰ */
interface BoardProblem {
  id: string
  type: 'board'
  sfen: string              // åˆæœŸç›¤é¢
  instruction: string       // ã€Œæ­©ã‚’1ãƒã‚¹å‰ã«å‹•ã‹ã—ã¦ãã ã•ã„ã€
  correctMoves: Move[][]    // æ­£è§£æ‰‹é †ï¼ˆè¤‡æ•°ãƒ‘ã‚¿ãƒ¼ãƒ³å¯ï¼‰
  movesRequired: number     // å¿…è¦æ‰‹æ•°ï¼ˆ1æ‰‹ã€œè¤‡æ•°æ‰‹ï¼‰
}

/** å•é¡Œï¼ˆåº§å­¦å‹ï¼‰- å°†æ¥æ‹¡å¼µç”¨ */
interface QuizProblem {
  id: string
  type: 'quiz'
  question: string
  options: string[]
  correctIndex: number
}

type Problem = BoardProblem | QuizProblem
```

### åˆå›ã‚³ãƒ¼ã‚¹: é§’ã®å‹•ã‹ã—æ–¹

```typescript
{
  id: 'piece-movement',
  title: 'é§’ã®å‹•ã‹ã—æ–¹',
  sections: [
    {
      id: 'fu-kin',
      title: 'æ­©ã¨é‡‘',
      lessons: [
        {
          id: 'fu-basics',
          title: 'æ­©ã®åŸºæœ¬',
          problems: [
            {
              id: 'fu-1',
              type: 'board',
              sfen: '9/9/9/9/4P4/9/9/9/9 b - 1',
              instruction: 'æ­©ã‚’1ãƒã‚¹å‰ã«å‹•ã‹ã—ã¦ãã ã•ã„',
              correctMoves: [[{ type: 'move', from: {row:4,col:4}, to: {row:3,col:4}, piece: 'fu', promote: false }]],
              movesRequired: 1,
            },
            // ... 5-10å•
          ],
        },
        // ... é‡‘ã®åŸºæœ¬
      ],
    },
    // ... ä»–ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³
  ],
}
```

### é§’ã®å­¦ç¿’é †åº

```
æ­© â†’ é‡‘ â†’ éŠ€ â†’ é¦™ â†’ é£› â†’ è§’ â†’ æ¡‚ â†’ ç‹
```

ã‚·ãƒ³ãƒ—ãƒ«ãªå‹•ã â†’ è¤‡é›‘ãªå‹•ãã®é †ã€‚

## ç”»é¢æ§‹æˆ

### 1. ã‚³ãƒ¼ã‚¹ä¸€è¦§ç”»é¢ï¼ˆ`/lesson` ã‚¿ãƒ–ï¼‰

```
+----------------------------------+
| [LogoHeader]                     |
+----------------------------------+
|                                  |
|  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  |
|  â”‚ é§’ã®å‹•ã‹ã—æ–¹               â”‚  |
|  â”‚ åŸºæœ¬ã®é§’ã®å‹•ãã‚’å­¦ã¼ã†     â”‚  |
|  â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  50%      â”‚  |
|  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  |
|                                  |
|  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  |
|  â”‚ ğŸ”’ åŸºæœ¬æ‰‹ç­‹                â”‚  |
|  â”‚ ï¼ˆæº–å‚™ä¸­ï¼‰                 â”‚  |
|  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  |
|                                  |
+----------------------------------+
```

### 2. ã‚»ã‚¯ã‚·ãƒ§ãƒ³ä¸€è¦§ç”»é¢ï¼ˆ`/lesson/[courseId]`ï¼‰

Duolingoé¢¨ã®ãƒ„ãƒªãƒ¼è¡¨ç¤ºã€‚

```
+----------------------------------+
| â† é§’ã®å‹•ã‹ã—æ–¹                   |
+----------------------------------+
|                                  |
|        â—‹ æ­©ã¨é‡‘ âœ“                |
|        â”‚                        |
|        â—‹ éŠ€ã¨æ¡‚ ğŸ”“               |
|        â”‚                        |
|        â—‹ é¦™ã¨é£› ğŸ”’               |
|        â”‚                        |
|        â—‹ è§’ã¨ç‹ ğŸ”’               |
|                                  |
+----------------------------------+
```

### 3. ãƒ¬ãƒƒã‚¹ãƒ³ç”»é¢ï¼ˆ`/lesson/[courseId]/[lessonId]`ï¼‰

```
+----------------------------------+
| Ã—                   1/5 â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘  |
+----------------------------------+
|                                  |
|   æ­©ã‚’1ãƒã‚¹å‰ã«å‹•ã‹ã—ã¦ãã ã•ã„   |
|                                  |
|       +-------------+            |
|       |             |            |
|       |   å°†æ£‹ç›¤    |            |
|       |             |            |
|       +-------------+            |
|                                  |
+----------------------------------+
|  [ã‚¹ã‚­ãƒƒãƒ—]        [ã‚ã‹ã‚‰ãªã„]  |
+----------------------------------+
```

### 4. çµæœç”»é¢

```
+----------------------------------+
|                                  |
|          ãƒ¬ãƒƒã‚¹ãƒ³å®Œäº†ï¼          |
|                                  |
|            â˜…â˜…â˜…                 |
|                                  |
|         æ­£è§£: 4/5å•              |
|                                  |
|  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  |
|  â”‚   é–“é•ãˆãŸå•é¡Œã‚’å¾©ç¿’ã™ã‚‹   â”‚  |
|  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  |
|                                  |
|  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  |
|  â”‚      æ¬¡ã®ãƒ¬ãƒƒã‚¹ãƒ³ã¸        â”‚  |
|  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  |
|                                  |
+----------------------------------+
```

## å®Ÿè£…ã‚¹ãƒ†ãƒƒãƒ—

### Step 1: ãƒ‡ãƒ¼ã‚¿æ§‹é€ ãƒ»ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿

**ãƒ•ã‚¡ã‚¤ãƒ«:** `packages/app/mocks/lessonData.ts`

- Course, Section, Lesson, Problem ã®å‹å®šç¾©
- ã€Œé§’ã®å‹•ã‹ã—æ–¹ã€ã‚³ãƒ¼ã‚¹ã®ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ï¼ˆæ­©ãƒ»é‡‘ã®ã¿ã§æœ€å°é™ï¼‰

### Step 2: useLessonGame ãƒ•ãƒƒã‚¯

**ãƒ•ã‚¡ã‚¤ãƒ«:** `packages/app/hooks/useLessonGame.ts`

```typescript
interface UseLessonGameReturn {
  boardState: BoardState
  currentProblemIndex: number
  totalProblems: number
  gameState: 'playing' | 'correct' | 'incorrect' | 'completed'
  instruction: string

  // ã‚»ãƒƒã‚·ãƒ§ãƒ³çµæœ
  results: { problemId: string; correct: boolean }[]

  handleCellPress: (row: number, col: number) => void
  handleCapturedPress: (pieceType: PieceType) => void
  handlePromotionSelect: (promote: boolean) => void

  nextProblem: () => void
  retry: () => void
  skip: () => void
}
```

### Step 3: ãƒ¬ãƒƒã‚¹ãƒ³ç”»é¢

**ãƒ•ã‚¡ã‚¤ãƒ«:** `packages/app/app/lesson/[courseId]/[lessonId].tsx`

- ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼
- å•é¡Œæ–‡è¡¨ç¤º
- ç›¤é¢æ“ä½œï¼ˆè©°å°†æ£‹UIã‚’æµç”¨ï¼‰
- æ­£è§£/ä¸æ­£è§£ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯

### Step 4: çµæœç”»é¢

**ãƒ•ã‚¡ã‚¤ãƒ«:** `packages/app/app/lesson/result.tsx`

- æ­£ç­”æ•°è¡¨ç¤º
- ã€Œé–“é•ãˆãŸå•é¡Œã‚’å¾©ç¿’ã€æ©Ÿèƒ½ï¼ˆstateçµŒç”±ã§æ¸¡ã™ï¼‰

### Step 5: ä¸€è¦§ç”»é¢

**ãƒ•ã‚¡ã‚¤ãƒ«:**
- `packages/app/app/(tabs)/lesson.tsx` - ã‚³ãƒ¼ã‚¹ä¸€è¦§
- `packages/app/app/lesson/[courseId]/index.tsx` - ã‚»ã‚¯ã‚·ãƒ§ãƒ³ä¸€è¦§

### Step 6: ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿æ‹¡å……

- æ®‹ã‚Š6é§’ã®ãƒ‡ãƒ¼ã‚¿è¿½åŠ ï¼ˆéŠ€ã€æ¡‚ã€é¦™ã€é£›ã€è§’ã€ç‹ï¼‰

## ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
packages/app/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ (tabs)/
â”‚   â”‚   â””â”€â”€ lesson.tsx              # ã‚³ãƒ¼ã‚¹ä¸€è¦§
â”‚   â””â”€â”€ lesson/
â”‚       â”œâ”€â”€ [courseId]/
â”‚       â”‚   â”œâ”€â”€ index.tsx           # ã‚»ã‚¯ã‚·ãƒ§ãƒ³ä¸€è¦§
â”‚       â”‚   â””â”€â”€ [lessonId].tsx      # ãƒ¬ãƒƒã‚¹ãƒ³ç”»é¢
â”‚       â””â”€â”€ result.tsx              # çµæœç”»é¢
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ useLessonGame.ts            # ãƒ¬ãƒƒã‚¹ãƒ³ãƒ­ã‚¸ãƒƒã‚¯
â”œâ”€â”€ mocks/
â”‚   â””â”€â”€ lessonData.ts               # ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿
â””â”€â”€ components/
    â””â”€â”€ lesson/
        â”œâ”€â”€ CourseCard.tsx          # ã‚³ãƒ¼ã‚¹ã‚«ãƒ¼ãƒ‰
        â”œâ”€â”€ SectionTree.tsx         # ã‚»ã‚¯ã‚·ãƒ§ãƒ³ãƒ„ãƒªãƒ¼
        â”œâ”€â”€ LessonProgress.tsx      # ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼
        â””â”€â”€ LessonResult.tsx        # çµæœè¡¨ç¤º
```

## å‚ç…§ãƒ•ã‚¡ã‚¤ãƒ«

| ãƒ•ã‚¡ã‚¤ãƒ« | ç”¨é€” |
|----------|------|
| `hooks/useTsumeshogiGame.ts` | ãƒ•ãƒƒã‚¯è¨­è¨ˆãƒ‘ã‚¿ãƒ¼ãƒ³ |
| `app/tsumeshogi/[id].tsx` | ç›¤é¢æ“ä½œUI |
| `components/shogi/ShogiBoard.tsx` | ç›¤é¢ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ |
| `lib/shogi/moveGenerator.ts` | ç§»å‹•å¯èƒ½ä½ç½®ã®è¨ˆç®— |
